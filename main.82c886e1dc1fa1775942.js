!function(){"use strict";var e,t={1199:function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.url=e,this.contentTypeHeader={"Content-Type":"application/json"}}var n,s,r;return n=t,(s=[{key:"getUsers",value:function(){return fetch("".concat(this.url,"/users"))}},{key:"login",value:function(e){return fetch("".concat(this.url,"/login"),{method:"POST",body:JSON.stringify(e),headers:this.contentTypeHeader})}},{key:"getChat",value:function(){return fetch("".concat(this.url,"/chat"))}},{key:"logoutRemove",value:function(e){return fetch("".concat(this.url,"/delete/").concat(e),{method:"DELETE"})}}])&&e(n.prototype,s),r&&e(n,r),t}();function n(e,t,n,s,r,i,a){try{var o=e[i](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(s,r)}function s(e){return function(){var t=this,s=arguments;return new Promise((function(r,i){var a=e.apply(t,s);function o(e){n(a,r,i,o,u,"next",e)}function u(e){n(a,r,i,o,u,"throw",e)}o(void 0)}))}}function r(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var i=function(){function e(n,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof n&&(this.element=document.querySelector(n)),this.api=new t(s),this.ws=new WebSocket("wss://chat-ws-serverside.herokuapp.com/ws"),this.you=null,this.loginElement=this.element.querySelector(".login"),this.formLogin=this.loginElement.querySelector(".login__form"),this.inputLogin=this.loginElement.querySelector(".login__input"),this.error=this.loginElement.querySelector(".login__error"),this.chatElement=this.element.querySelector(".chat"),this.formChat=this.chatElement.querySelector(".chat__form"),this.inputChat=this.chatElement.querySelector(".chat__input"),this.messageList=this.chatElement.querySelector(".chat__messages-list"),this.btnLogout=this.chatElement.querySelector(".chat__logout"),this.usersList=this.chatElement.querySelector(".chat__users"),this.getUsersData=this.getUsersData.bind(this),this.login=this.login.bind(this),this.logout=this.logout.bind(this),this.validate=this.validate.bind(this),this.loggedIn=this.loggedIn.bind(this),this.sendMessage=this.sendMessage.bind(this),this.sync=this.sync.bind(this),this.renderUsers=this.renderUsers.bind(this),this.renderMessages=this.renderMessages.bind(this),this.formLogin.addEventListener("submit",this.login),this.inputLogin.addEventListener("input",this.validate),this.formChat.addEventListener("submit",this.sendMessage),this.btnLogout.addEventListener("click",this.logout),this.ws.addEventListener("message",this.sync)}var n,i,a,o,u,c,h;return n=e,i=[{key:"getUsersData",value:(h=s(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.getUsers();case 3:return t=e.sent,e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Что то пошло не так("),e.abrupt("return",{users:[],status:!1,message:e.t0.message});case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return h.apply(this,arguments)})},{key:"getMessagesData",value:(c=s(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.getChat();case 3:return t=e.sent,e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Что то пошло не так("),e.abrupt("return",{messages:[],status:!1,message:e.t0.message});case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return c.apply(this,arguments)})},{key:"validate",value:function(e){""!==e.target.value.trim()&&(this.error.innerHTML="")}},{key:"login",value:function(e){var t=this;e.preventDefault();var n={username:this.inputLogin.value};this.api.login(n).then((function(e){return e.json()})).then((function(e){e.status||(t.error.innerHTML=e.message),"ok"===e.status&&t.loggedIn(e.user)}));var s=this.inputLogin.value;this.ws.send(JSON.stringify({user:s})),this.inputLogin.value=""}},{key:"loggedIn",value:function(e){this.you=e,this.chatElement.classList.remove("hidden"),this.loginElement.classList.add("hidden"),this.renderUsers(),this.renderMessages()}},{key:"logout",value:function(){var e=this;this.api.logoutRemove(this.you.id).then((function(e){return e.json()})).then((function(t){"ok"===t.status&&e.ws.send(JSON.stringify({}))})),this.you=null,this.chatElement.classList.add("hidden"),this.loginElement.classList.remove("hidden")}},{key:"sendMessage",value:function(e){e.preventDefault();var t=this.inputChat.value;""!==t.trim()&&this.ws.send(JSON.stringify({message:t,user:this.you.name})),this.inputChat.value=""}},{key:"sync",value:function(e){var t,n=e.data,s=JSON.parse(n);if(s.type&&s.type.message)return t=this.you.name===s.data.user?'<div class="chat__message your">\n                      <div>\n                        <span>You</span>\n                        <span>'.concat(s.data.time.slice(0,-3)," ").concat(s.data.date,"</span>\n                      </div>\n                      <div>").concat(s.data.message,"</div>\n                    </div>"):'<div class="chat__message">\n                      <div>\n                        <span>'.concat(s.data.user,"</span>\n                        <span>").concat(s.data.time.slice(0,-3)," ").concat(s.data.date,"</span>\n                      </div>\n                      <div>").concat(s.data.message,"</div>\n                    </div>"),void this.messageList.insertAdjacentHTML("beforeend",t);if(this.you&&s.type&&s.type.user!==this.you.name){var r='<div class="chat__user">'.concat(s.data.user,"</div>");this.usersList.insertAdjacentHTML("beforeend",r)}s.type&&0===Object.keys(s.type).length&&this.renderUsers()}},{key:"renderUsers",value:(u=s(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.usersList.innerHTML="",e.next=3,this.getUsersData();case 3:this.usersData=e.sent,this.usersData.loginUsers.forEach((function(e){var n;t.you&&t.you.name===e.name?n='<div class="chat__user you">You</div>':e.name&&(n='<div class="chat__user">'.concat(e.name,"</div>")),n&&t.usersList.insertAdjacentHTML("beforeend",n)}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"renderMessages",value:(o=s(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.you){e.next=2;break}return e.abrupt("return");case 2:return this.messageList.innerHTML="",e.next=5,this.getMessagesData();case 5:this.messagesData=e.sent,this.messagesData.messages.forEach((function(e){var n;n=t.you.name===e.user?'<div class="chat__message your">\n                      <div>\n                        <span>You</span>\n                        <span>'.concat(e.time.slice(0,-3)," ").concat(e.date,"</span>\n                      </div>\n                      <div>").concat(e.message,"</div>\n                    </div>"):'<div class="chat__message">\n                      <div>\n                        <span>'.concat(e.user,"</span>\n                        <span>").concat(e.time.slice(0,-3)," ").concat(e.date,"</span>\n                      </div>\n                      <div>").concat(e.message,"</div>\n                    </div>"),t.messageList.insertAdjacentHTML("beforeend",n)}));case 7:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})}],i&&r(n.prototype,i),a&&r(n,a),e}(),a=new i(".app","https://chat-ws-serverside.herokuapp.com");window.chatApp=a}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,s),i.exports}s.m=t,e=[],s.O=function(t,n,r,i){if(!n){var a=1/0;for(h=0;h<e.length;h++){n=e[h][0],r=e[h][1],i=e[h][2];for(var o=!0,u=0;u<n.length;u++)(!1&i||a>=i)&&Object.keys(s.O).every((function(e){return s.O[e](n[u])}))?n.splice(u--,1):(o=!1,i<a&&(a=i));if(o){e.splice(h--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var h=e.length;h>0&&e[h-1][2]>i;h--)e[h]=e[h-1];e[h]=[n,r,i]},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={179:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,i,a=n[0],o=n[1],u=n[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(r in o)s.o(o,r)&&(s.m[r]=o[r]);if(u)var h=u(s)}for(t&&t(n);c<a.length;c++)i=a[c],s.o(e,i)&&e[i]&&e[i][0](),e[a[c]]=0;return s.O(h)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),s.O(void 0,[202],(function(){return s(1202)}));var r=s.O(void 0,[202],(function(){return s(1199)}));r=s.O(r)}();